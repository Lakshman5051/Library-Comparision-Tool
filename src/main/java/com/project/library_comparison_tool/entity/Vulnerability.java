package com.project.library_comparison_tool.entity;

import jakarta.persistence.*;
import lombok.*;

import java.time.LocalDate;

/**
 * Entity to store security vulnerability details for libraries
 */
@Entity
@Table(name = "vulnerability")
@Getter
@Setter
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class Vulnerability {

    @Id
    @GeneratedValue(strategy = GenerationType.SEQUENCE, generator = "vulnerability_seq")
    @SequenceGenerator(
            name = "vulnerability_seq",
            sequenceName = "vulnerability_seq",
            allocationSize = 1
    )
    private Long id;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "library_id", nullable = false)
    private Library library;

    @Column(nullable = false)
    private String vulnerabilityId; // CVE ID, GHSA ID, or OSV ID (e.g., "CVE-2023-1234", "GHSA-xxxx-xxxx-xxxx")

    @Column(length = 500)
    private String summary; // Brief description of the vulnerability

    @Column(columnDefinition = "TEXT")
    private String details; // Detailed description

    @Column(length = 50)
    private String severity; // "CRITICAL", "HIGH", "MEDIUM", "LOW"

    @Column
    private String cvssScore; // CVSS score (e.g., "9.8", "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H")

    @Column(length = 100)
    private String affectedVersionRange; // Version range affected (e.g., ">=1.0.0, <1.2.0")

    @Column(length = 100)
    private String fixedVersion; // Fixed in version (e.g., "1.2.0")

    @Column
    private LocalDate publishedDate; // When vulnerability was published

    @Column
    private LocalDate modifiedDate; // Last modified date

    @Column(length = 500)
    private String source; // Source of vulnerability (e.g., "OSV", "GitHub", "NVD")

    @Column(name = "references_url", length = 1000)
    private String references; // Comma-separated URLs for more information

    @Column(nullable = false)
    private LocalDate lastChecked; // When we last checked this vulnerability
}

